<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="./js/rem.js"></script>
  <link rel="stylesheet" href="./css/rest.css">
  <link rel="stylesheet" href="./css/register.css">
  <title>邀请好友注册</title>
</head>

<body>
  <div class="register">
    <div id="vagueView" class="vagueBgView" onclick="dissmissVagueView()"></div>
    <div class="banner">
      <div class="balance">
        QBT余额
        <span>1,000,000</span>
      </div>
      <p class="wait">还在等什么？</p>
    </div>
    <div class="content">
      <div class="title">新人奖励</div>
      <p>注册即领取
        <span>100</span>QBT</p>
      <input type="text" placeholder="请输入您的手机号/邮箱地址" id="username">
      <button onclick="clickReceiveBtn()">领取</button>
    </div>
    <div id="success" class="successAlert">
      <img src="./images/success.png" alt="">
      <p>领取成功</p>
      <div class="asset">
        您当前的资产<span>100</span>/QBT
      </div>
      <a href="http://192.168.113.3/Share/" target="_blank">下载QBapp,登录即查看资产~</a>
    </div>

    <div id="failure" class="failureAlert">

    </div>
  </div>


  <script src="https://lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script>
  <script type="text/javascript">
    function clickReceiveBtn() {
      // 获取url中的参数
      function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) {
          return unescape(r[2]);
        } else {
          return null;
        }
      }
      //获取url中的uid参数
      var uid = getUrlParam('uid');
      var account = getUrlParam('account');
      var invited = document.getElementById("username").value;
      //			console.log(invited);
      if (invited.value = "") {
        return;
      }
      //验证手机号是否合法
      var p1 = /^[1][3,4,5,7,8][0-9]{9}$/;
      //验证邮箱号是否合法
      var p2 = /^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/;
      var me = false;
      if (p1.test(invited) || p2.test(invited)) me = true;
      if (!me) {
        alert("请输入正确的手机号或邮箱");
        return;
      }

      $.ajax('http://192.168.113.3:8090/wallet/crt/invite', {
        data: {
          "inviter": uid,
          "inviterAccount": account,
          "invited": invited
        },
        dataType: 'json', //服务器返回json格式数据
        type: 'post', //HTTP请求类型
        timeout: 10000, //超时时间设置为10秒；
        headers: {
          'Content-Type': 'application/json'
        }, //设置请求头
        success: function (data) {
          //服务器返回响应，根据响应结果，分析是否领取成功；
          var jsonStr = JSON.stringify(data);
          //					console.log(jsonStr);
          //					alert(jsonStr);
          var obj = new Function("return" + jsonStr)(); //转换后的JSON对象
          if (obj.code == 200) { //成功领取

            var successAlert = document.getElementById("success");
            successAlert.style.display = "inline-block";
            var bgView = document.getElementById("vagueView");
            bgView.style.display = "inline-block";
          } else if (obj.code == 207) { //已领取过
            var failureAlert = document.getElementById("failure");
            failureAlert.style.display = "inline-block";
            var bgView = document.getElementById("vagueView");
            bgView.style.display = "inline-block";
          } else { //领取失败
            alert(obj.msg);
          }
        },
        error: function (xhr, type, errorThrown) {
          //异常处理；
          console.log(type);
          // alert(type);
        }
      });
    }
  </script>
  <script type="text/javascript">
    function clickCancelBtn() {
      var bgView = document.getElementById("vagueView");
      bgView.style.display = "none";
      var successAlert = document.getElementById("failure");
      successAlert.style.display = "none";
    }
  </script>
  <script type="text/javascript">
    function dissmissVagueView() {
      var successAlert = document.getElementById("success");
      successAlert.style.display = "none";
      var bgView = document.getElementById("vagueView");
      bgView.style.display = "none";
      var successAlert = document.getElementById("failure");
      successAlert.style.display = "none";
      $('#username').removeAttr("disabled");
    }
  </script>
</body>

</html>